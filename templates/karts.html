<!DOCTYPE html>
<html>
<head>
    <title>Kart Manager - Kart</title>
    <link rel="icon" type="image/png" href="https://www.k1speed.com/wp-content/uploads/2025/10/k1speed-logo-short-red.png">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="overlay">
    <h1>ğŸï¸ Gestione Kart</h1>

    <div class="top-nav">
        <a href="/" class="nav-btn">Gestione Riparazioni</a>
        <a href="/karts" class="nav-btn">ğŸï¸ Gestione Kart</a>
        <a href="/parts" class="nav-btn">ğŸ› ï¸ Gestione Pezzi</a>
        <a href="/technicians" class="nav-btn">ğŸ‘¨â€ğŸ”§ Gestione Tecnici</a>
    </div>

    <form action="/add_kart" method="post">
        <input type="number" name="kart_num" placeholder="Numero Kart" required min="1">
        <input type="text" name="modello" placeholder="Modello (es. Sodi RSX)" required>

        <select name="stato" required>
            <option value="">Seleziona Stato</option>
            <option value="Disponibile">Disponibile</option>
            <option value="In Riparazione">In Riparazione</option>
            <option value="Fuori Servizio">Fuori Servizio</option>
        </select>

        <button type="submit">Aggiungi</button>
    </form>

    <form method="get" action="/karts" style="margin-bottom: 20px; display:flex; gap:20px; align-items:center; justify-content:center;">

        <!-- Filtro Modello -->
        <div>
            <label>Modello:</label>
            <select name="modello" onchange="this.form.submit()">
                <option value="">Tutti</option>
                {% for m in modelli %}
                    <option value="{{ m }}" {% if m == filtro_modello %}selected{% endif %}>{{ m }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Filtro Stato Dinamico -->
        <div>
            <label>Stato:</label>
            <select name="stato" onchange="this.form.submit()">
                <option value="Tutti">Tutti</option>
                {% for s in stati %}
                    <option value="{{ s }}" {% if s == filtro_stato %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </div>

    </form>


    <table>
        <tr>
            <th>ID</th>
            <th>Numero Kart</th>
            <th>Modello</th>
            <th>Stato</th>
            <th>Note</th>
            <th>Azioni</th>
            <th>Elimina</th>
        </tr>

        {% for k in karts %}
        <tr>
            <td>{{ k[0] }}</td>
            <td><b>#{{ k[1] }}</b></td>
            <td>{{ k[2] }}</td>
            <td>{{ k[3] }}</td>

           <td class="note-cell">
                <form action="/update_kart_note/{{ k[0] }}" method="post" class="note-form">
                    <textarea name="note" placeholder="Scrivi una nota...">{{ k[4] }}</textarea>
                    <button type="submit">ğŸ’¾</button>
                </form>
            </td>

            <td>
                <select onchange="location = this.value;">
                    <option value="">Seleziona Azione</option>
                    <option value="/change_kart_status/{{ k[0] }}/Disponibile">Disponibile</option>
                    <option value="/change_kart_status/{{ k[0] }}/In Riparazione">Riparazione</option>
                    <option value="/change_kart_status/{{ k[0] }}/Fuori Servizio">Fuori Servizio</option>
                    <option value="/change_kart_status/{{ k[0] }}/Dismesso">Dismesso</option>
                </select>
            </td>

            <td>
                <button onclick="if(confirm('Sei sicuro di voler eliminare questo kart?')) { location.href='/remove_kart/{{ k[0] }}'; }">
                    ğŸ—‘ï¸
                </button>
            </td>
        </tr>
        {% endfor %}
    </table>

</div>

</body>
</html>
